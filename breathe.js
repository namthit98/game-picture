(function(b,c){'use strict';var g='breathe';'function'==typeof define&&define.amd?define([],function(){return b[g]=c(b)}):'object'==typeof module&&module.exports?module.exports=b[g]=c(b):b[g]=c(b)})(this,function(){'use strict';var c={pending:1,resolved:2,rejected:3},g=function(ea){return'function'==typeof ea},h=function(ea){return'object'==typeof ea},j=function(ea){var fa=this;this.state=c.pending,this.immediate=j.runImmediately,this._pendingThen=[],this._pendingCatch=[],this.resolve=function(ga){fa.state!==c.pending||(fa.state=c.resolved,fa._value=ga,fa._runFn(function(){fa._clearResolvedQueue()}))},this.reject=function(ga){fa.state!==c.pending||(fa.state=c.rejected,fa._reason=ga,!fa._pendingCatch.length&&j.loggingErrors&&(fa._loggingErrorTimeout=setTimeout(function(){console.warn(fa._reason)},j.loggingErrorTimeout)),fa._runFn(function(){fa._clearRejectedQueue()}))},ea.call(this,this.resolve,this.reject)},k=function(ea,fa,ga,ha){var ia,ja=!1;try{if(fa===ea)return void ha(new TypeError('Recursive Promise Detected'));ia=fa&&fa.then,(h(fa)||g(fa))&&g(ia)?ia.call(fa,function(ka){return ja?void 0:fa===ka?void ha(new TypeError('Recursive Promise Detected')):void(ja=!0,k(ea,ka,ga,ha))},function(ka){ja||(ja=!0,ha(ka))}):ga(fa)}catch(ka){ja||ha(ka)}};j.prototype={_clearResolvedQueue:function(){for(;this._pendingThen.length;)this._pendingThen.shift()(this._value)},_clearRejectedQueue:function(){for(;this._pendingCatch.length;)this._pendingCatch.shift()(this._reason)},_runFn:function(ea){this.immediate?ea():setTimeout(ea,0)},then:function(ea,fa){var ga=this,ha={};return ha=new j(function(ia,ja){var ka=ga.state===c.rejected?null:function(ma){if(g(ea))try{k(ha,ea(ma),ia,ja)}catch(na){ja(na)}else ia(ma)},la=ga.state===c.resolved?null:function(ma){if(g(fa))try{k(ha,fa(ma),ia,ja)}catch(na){ja(na)}else ja(ma)};ga._pendingThen.push(ka),ga._pendingCatch.push(la),clearTimeout(ga._loggingErrorTimeout),ga.state===c.resolved?ga._runFn(function(){ga._clearResolvedQueue()}):ga.state===c.rejected&&ga._runFn(function(){ga._clearRejectedQueue()})}),ha},'catch':function(ea){this.then(null,ea)}},j.resolve=function(ea){var fa=new j(function(ga,ha){k({},ea,ga,ha)});return fa},j.reject=function(ea){return new j(function(fa,ga){ga(ea)})},j.version='0.1.1',j.loggingErrors=!0,j.loggingErrorTimeout=3e3,j.runImmediately=!0,j.states=c;var l={version:'0.2.1-0.1.1'},m=17,n=-1,q='Stopped';l.STOP_MESSAGE=q;var E,u=2,w=3,x=4,z=7,A=8,C=m,D=2,F=!1,G='undefined'!=typeof performance&&performance.now?performance:{now:function(){return new Date().getTime()}},H=function(ea,fa){if(ea)for(var ga in ea)ea.hasOwnProperty(ga)&&(fa[ga]=ea[ga]);return fa},I=function(){return new j(L)};l.getBatchTime=function(){return C},l.setBatchTime=function(ea){return C=ea,l},l.getCurrWorkId=function(){return E};var J=function(ea){return ea&&'function'==typeof ea.then},K=function(){return D++};l.uniqueId=K;var L=function(){},N=function(ea){return'function'==typeof ea?N(ea()):ea};l.setTimeout=function(ea){return ea=ea||0,{prework:null,postwork:function(fa){return setTimeout(fa,ea)},timeout:function(fa){return setTimeout(fa,ea)},cancel:function(fa){return clearTimeout(fa)}}},H(l.setTimeout(),l.setTimeout),l.requestAnimationFrame=function(){return{prework:function(ea){return requestAnimationFrame(ea)},postwork:null,timeout:function(ea){return requestAnimationFrame(ea)},cancel:function(ea){return cancelAnimationFrame(ea)}}},H(l.requestAnimationFrame(),l.requestAnimationFrame);var P,O=l.setTimeout,Q=function(ea,fa){O.cancel(P),O=ea,void 0!==fa&&l.setBatchTime(fa),F&&O.postwork||O.timeout(W)};l.animationMode=function(){return Q(l.requestAnimationFrame,12)},l.timeoutMode=function(){return Q(l.setTimeout,m)};var R={},S=function(ea,fa){R[ea]=fa};l.throttle=function(ea,fa){ea&&ea.getWorkId()?l.throttle(ea.getWorkId(),fa):S(ea,fa)};var T=[],U=[],V=[],W=function(){var fa,ga,ea=G.now(),ha={};for(F=!0,O.prework&&(P=O.prework(W)),fa=0;fa<T.length;fa++)E=T[fa].id,T[fa].warmup();for(T=[],fa=0;fa<U.length&&G.now()-ea<C;fa++)ga=U[fa].id,E=ga,R[ga]?(ha[ga]=(ha[ga]||0)+1,ha[ga]>R[ga]?U[fa].cooldown():U[fa].work()):U[fa].work();for(fa=fa;fa<U.length;fa++)E=U[fa].id,U[fa].cooldown();for(U=[],fa=0;fa<V.length;fa++)E=V[fa].id,V[fa].cooldown();V=[],O.postwork&&(P=O.postwork(W)),E=n,F=!1};E=n,W();var X=function(ea){T.push(ea)},Y=function(ea){U.push(ea)},Z=function(ea,fa){var ga=function(){Y({work:fa,cooldown:ha,id:ea})},ha=function(){X({warmup:ga,id:ea})};ga()};l.queue=function(ea){return Z(E,ea),l};var $=function(ea,fa){return function(){var ga=E;E=N(ea);var ha=fa.apply(this,arguments);return E=ga,ha}},_=function(){this.state=1};_.prototype={pause:function(){var ea=this;if(this.state===x)return j.resolve();if(this.state===w)return this.callGate;if(this.state===z)return j.reject('Can\'t Pause. Already Stopping.');if(this.state===A)return j.reject('Can\'t Pause. Already Stopped.');this.state=w;var fa=this.currVal;return fa&&fa.then&&fa.pause?(this.pauser=fa,this.callGate=j.resolve(fa.pause()).then(function(){ea.state=x})):this.callGate=I(),this.callGate},unpause:function(){var ea;return this.state===z?j.reject('Can\'t Unpause. Already Stopping.'):this.state===A?j.reject('Can\'t Unpause. Already Stopped.'):(this.state=u,this.pauseGate&&(ea=this.pauseGate,this.pauseGate=null,ea.resolve()),this.pauser?(ea=this.pauser,this.pauser=null,j.resolve(ea.unpause())):j.resolve())},stop:function(){var fa,ea=this;if(this.state===A)return j.resolve();this.state===w&&this.callGate.reject('Pausing interrupted by stop.');var ga=this.currVal;return(ga&&ga.then&&ga.stop&&(this.state=z,fa=j.resolve(ga.stop()).then(function(){ea.state=A})),this.state===x&&this.pauseGate)?(this.state=A,this.pauseGate.reject(q),j.resolve()):(this.state=z,this.callGate=fa||I(),this.callGate)},gatesPromise:function(ea){var fa=this.callGate;return this.state===u?ea:this.state===z?(this.callGate&&(this.callGate=null,fa.resolve()),this.state=A,j.reject(q)):this.state===w?(this.callGate&&(this.callGate=null,fa.resolve()),this.state=x,this.pauseGate=I(),this.pauseGate):this.state===A?j.reject(q):this.state===x?(this.pauseGate||(this.pauseGate=I()),this.pauseGate):ea}};var aa=function(ea){var ha,fa=j.resolve(),ga=E,ia=new _,ja=function(){return fa.state===c.resolved||fa.state===c.rejected},ka=function(na){return ia.gatesPromise(na)},la=function(na){return function(){var oa=ia[na]();return ja()&&(fa=fa.then(ka)),oa}},ma={throttle:function(na){S(_id,na)},pause:la('pause'),stop:la('stop'),unpause:la('unpause'),atEnd:ja,then:function(na,oa){return fa=fa.then(ka).then(na?function(pa){return new j(function(qa,ra){Z(ga,function(){j.resolve().then(ka).then($(ga,function(){try{ha=na(pa),ia.currVal=ha,qa(ha)}catch(sa){ra(sa)}}))})})}:null,oa?$(ga,oa):null).then(ka),ma},getWorkId:function(){return ga}};return ma['catch']=function(na){return ma.then(null,na)},ma.then(function(){return ia.state=u,ha='function'==typeof ea?new j(ea):ea,ia.currVal=ha,ha}),ma};l.chain=aa;var ba=function(ea){var fa=E;ea=ea||{};var ga=ea.body,ha=ea.condition,ia=ea.initVal,ja=new _,ka=aa(function(la,ma){var na,oa,qa=function(){ea.onBatchBegin&&ea.onBatchBegin(),Y(na)};na={work:function(){if(ja.state===w)return ja.state=x,ja.pauseGate=I(),ja.pauseGate.then(function(){ja.pauseGate=null,qa()}),ja.callGate.resolve(),void(ja.callGate=null);if(ja.state===z)return ja.state=A,ma(q),ja.callGate.resolve(),void(ja.callGate=null);try{if(!ha())return void la();ia=ga(),ja.currVal=ia,J(ia)?ia.then(function(sa){ia=sa,ja.currVal=sa,Y(na)},ma):Y(na)}catch(sa){ma(sa)}},cooldown:function(){ea.onBatchEnd&&ea.onBatchEnd(),X(oa)},id:fa},oa={warmup:qa,id:fa},ja.state=u,qa()});return ka.pause=function(){return ja.pause()},ka.unpause=function(){return ja.unpause()},ka.stop=function(){return ja.stop()},aa(ka)};l.loop=function(ea,fa,ga){var ha;return ga=H(ga,{}),ha=1===arguments.length?arguments[0]:H({condition:ea,body:fa},ga),ba(ha)};var ca=function(ea){var fa=H(ea,{}),ga=ea.body,ha=ea.iterations,ia=0;return fa=H({condition:function(){return ia<ha},body:function(ja){return ga(ia++,ja)}},fa),ba(fa)};l.times=function(ea,fa,ga){var ha;return ga=H(ga,{}),ha=1===arguments.length?arguments[0]:H({iterations:ea,body:fa},ga),ca(ha)},l.stopChain=function(ea){return l.chain(ea&&ea.stop&&ea.stop())},l.pauseChain=function(ea){return l.chain(ea&&ea.pause&&ea.pause())},l.unpauseChain=function(ea){return l.chain(ea&&ea.unpause&&ea.unpause())};var da=function(ea){void 0===ea&&(ea=K());var fa={throttle:function(ga){return S(ea,ga),fa},chain:$(ea,aa),loop:$(ea,l.loop),times:$(ea,l.times)};return fa};return l.tag=da,l.withId=da,l});