$(document).ready(function(){function a(F){return new Promise(function(G,H){if(F.files&&F.files[0]){let I=new FileReader;I.onload=function(J){G(J.target.result)},I.readAsDataURL(F.files[0])}else H(new Error("Don't load image ...."))})}function b(){return c(),breathe.times(A,d).then(function(){return w=0,z=0,breathe.times(A,f)}).then(g)}function c(){q.css("grid-template-columns",`repeat(${v}, 1fr)`),q.css("grid-template-rows",`repeat(${rows}, 1fr)`),q.css("background-color","#fff"),o.attr("disabled",!0),o.text("Reset"),r.css("display","block"),j.attr("disabled",!0),m.css("display","block"),p.html(""),q.html(""),w=0,z=0,A=v*rows,B=s/v,C=t/rows}function d(F){let G,H;5>v?(G=50,H=25):15>v?(G=60,H=50):20>v?(G=70,H=40):50>=v&&(G=90,H=80),0==F%v&&0!==F&&(z+=C,w=0),w=F*B;let I=document.createElement("div");I.className="el",I.setAttribute("data-id",F),I.style.backgroundImage=`url("${u}")`,I.style.backgroundSize=`${s}px ${t}px`,I.style.backgroundPositionX=`-${w}px`,I.style.backgroundPositionY=`-${z}px`,I.style.position="absolute",I.style.top=`${Math.floor(Math.random()*(G-5+1))+5}%`,I.style.left=`${Math.floor(Math.random()*(H-5+1))+5}%`,I.style.width=B+"px",I.style.height=C+"px",I.style.zIndex=`${Math.floor(Math.random()*101)+0}`,$(I).draggable({containment:".game-area",scroll:!1,zIndex:1e9,start:function(J){E=J},stop:function(J){const K=J.target;K.style.zIndex=`${D++}`}}),p.append(I)}function f(F){0==F%v&&0!==F&&(z+=C,w=0),w=F*B;let G=document.createElement("div");G.className="el",G.setAttribute("data-id",F),G.style.backgroundSize=`${s}px ${t}px`,G.style.backgroundPositionX=`-${w}px`,G.style.backgroundPositionY=`-${z}px`,$(G).droppable({drop:function(H){const I=E.target;I.dataset.id===H.target.dataset.id&&(I.remove(),H.target.style.backgroundImage=`url("${u}")`)},over:function(H){const I=E.target;I.style.border=I.dataset.id===H.target.dataset.id?"10px solid #DB261D":"1px solid transparent"}}),q.append(G)}function g(){m.css("display","none"),o.attr("disabled",!1),j.attr("disabled",!1),r.css("display","none")}const h=$(".setting__choose-level p")[0],j=$(".setting__choose-image input"),k=$(".setting__input-range"),l=$(".setting__preview-image img"),m=$(".game-area .loader"),n=$(".setting__preview-image .loader"),o=$(".btn-start"),p=$(".pieces"),q=$(".image"),r=$(".bg"),s=q.width(),t=q.height();let u,v=rows=k.val(),w=0,z=0,A=v*rows,B=s/v,C=t/rows,D=1e4,E;o.attr("disabled",!0),h.textContent=k.val(),k.on("input",function(){h.textContent=this.value,v=rows=this.value}),$(".setting__input-file").change(function(){n.css("display","block"),a(this).then(function(F){l.attr("src",F),u=F,o.attr("disabled",!1)}).then(function(){n.css("display","none")})}),o.click(function(){b(u)})});